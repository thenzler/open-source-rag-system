# Environment Configuration
# Copy this file to .env and update the values

# =============================================================================
# SIMPLE RAG SYSTEM PATHS (for simple_api.py)
# =============================================================================
# Base directory for the RAG system
RAG_SYSTEM_BASE_DIR=C:/Users/THE/open-source-rag-system

# Data directories
RAG_DATA_DIR=./data
RAG_UPLOAD_DIR=./data/storage/uploads
RAG_PROCESSED_DIR=./data/storage/processed
RAG_OUTPUT_DIR=./output

# Configuration directory
RAG_CONFIG_DIR=./config

# Ollama configuration
OLLAMA_EXECUTABLE=C:/Users/THE/AppData/Local/Programs/Ollama/ollama.exe
OLLAMA_HOST=http://localhost:11434

# =============================================================================
# DATABASE CONFIGURATION
# =============================================================================
# Primary database (SQLite for development, PostgreSQL for production)
DATABASE_TYPE=sqlite  # Options: sqlite, postgresql
DATABASE_PATH=data/rag_database.db  # For SQLite
AUDIT_DATABASE_PATH=data/audit.db   # For audit logging

# PostgreSQL Configuration (for production)
USE_POSTGRESQL=false
POSTGRES_USER=raguser
POSTGRES_PASSWORD=change_this_secure_password_123
POSTGRES_DB=ragdb
DATABASE_URL=postgresql://raguser:change_this_secure_password_123@postgres:5432/ragdb

# Connection Pooling (NEW: Production performance)
DB_POOL_MIN_SIZE=2
DB_POOL_SIZE=10
DB_POOL_MAX_OVERFLOW=20
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# =============================================================================
# SECURITY CONFIGURATION  
# =============================================================================
SECRET_KEY=change_this_super_secret_key_for_production_use_256_bits
JWT_SECRET_KEY=another_secret_key_for_jwt_tokens_change_this_too
JWT_EXPIRE_MINUTES=60
BCRYPT_ROUNDS=12

# Encryption at rest (NEW: Tenant-specific encryption)
ENCRYPTION_ENABLED=true
ENCRYPTION_KEY_FILE=data/encryption.key
ENCRYPTION_ALGORITHM=Fernet
ENCRYPTION_KEY_DERIVATION_ROUNDS=100000

# ID Obfuscation (NEW: Security through obscurity)
ID_OBFUSCATION_ENABLED=true
ID_OBFUSCATION_SALT=change_this_obfuscation_salt_256_bits

# CSRF Protection (NEW: Enhanced security)
CSRF_PROTECTION_ENABLED=true
CSRF_TOKEN_EXPIRY_HOURS=24

# =============================================================================
# VECTOR DATABASE CONFIGURATION
# =============================================================================
QDRANT_URL=http://qdrant:6333
QDRANT_API_KEY=optional_api_key_for_qdrant
QDRANT_COLLECTION_NAME=documents
VECTOR_DIMENSION=768

# =============================================================================
# LLM CONFIGURATION
# =============================================================================
LLM_SERVICE_URL=http://ollama:11434
LLM_MODEL_NAME=llama3.1:8b
LLM_TEMPERATURE=0.1
LLM_MAX_TOKENS=1000
LLM_TIMEOUT_SECONDS=60

# Alternative LLM configurations (uncomment to use)
# LLM_PROVIDER=vllm
# VLLM_MODEL_PATH=/models/llama-3.1-8b-instruct
# OPENAI_API_KEY=your_openai_key_here  # For testing purposes

# =============================================================================
# EMBEDDING MODEL CONFIGURATION
# =============================================================================
EMBEDDING_MODEL=sentence-transformers/all-mpnet-base-v2
EMBEDDING_DEVICE=cpu  # or cuda for GPU acceleration
EMBEDDING_BATCH_SIZE=32
EMBEDDING_MAX_LENGTH=512

# Alternative embedding models
# EMBEDDING_MODEL=sentence-transformers/paraphrase-multilingual-mpnet-base-v2  # Multilingual
# EMBEDDING_MODEL=microsoft/codebert-base  # For code documents

# =============================================================================
# DOCUMENT PROCESSING CONFIGURATION
# =============================================================================
UPLOAD_DIRECTORY=/app/storage/uploads
PROCESSED_DIRECTORY=/app/storage/processed
MAX_FILE_SIZE_MB=100
SUPPORTED_FORMATS=pdf,docx,xlsx,xml,txt,md,csv

# Text processing settings
CHUNK_SIZE=512
CHUNK_OVERLAP=50
MIN_CHUNK_SIZE=100
MAX_CHUNK_SIZE=2000

# OCR settings (for scanned PDFs)
ENABLE_OCR=false
OCR_LANGUAGE=eng
TESSERACT_CONFIG=--psm 3

# =============================================================================
# REDIS CONFIGURATION
# =============================================================================
REDIS_URL=redis://redis:6379/0
REDIS_PASSWORD=
REDIS_MAX_CONNECTIONS=50
CACHE_TTL_SECONDS=3600

# Celery configuration
CELERY_BROKER=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/1
CELERY_TASK_SERIALIZER=json
CELERY_RESULT_SERIALIZER=json

# =============================================================================
# API CONFIGURATION
# =============================================================================
API_HOST=0.0.0.0
API_PORT=8000
API_WORKERS=4
CORS_ORIGINS=http://localhost:3000,http://localhost:8080
API_PREFIX=/api/v1

# Rate limiting
RATE_LIMIT_REQUESTS_PER_MINUTE=60
RATE_LIMIT_BURST=10
UPLOAD_RATE_LIMIT_PER_HOUR=100

# =============================================================================
# MONITORING AND LOGGING (NEW: Enterprise-grade monitoring)
# =============================================================================
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILE=/app/logs/app.log
LOG_ROTATION=10MB
LOG_RETENTION_DAYS=30

# Prometheus Metrics (NEW: Complete monitoring stack)
ENABLE_METRICS=true
METRICS_PORT=8001
PROMETHEUS_MULTIPROC_DIR=/tmp/prometheus_multiproc
METRICS_COLLECTION_INTERVAL=15

# System Monitoring (NEW: Resource tracking)
ENABLE_SYSTEM_METRICS=true
CPU_MONITORING_INTERVAL=5
MEMORY_MONITORING_INTERVAL=5
DISK_MONITORING_INTERVAL=30

# Application Metrics (NEW: RAG-specific monitoring)
TRACK_QUERY_METRICS=true
TRACK_DOCUMENT_METRICS=true
TRACK_LLM_METRICS=true
TRACK_VECTOR_METRICS=true

# Health check configuration
HEALTH_CHECK_INTERVAL=30
HEALTH_CHECK_TIMEOUT=10

# Grafana Configuration (NEW: Visualization)
GRAFANA_ADMIN_PASSWORD=admin123
GRAFANA_PORT=3000
GRAFANA_AUTO_PROVISION_DASHBOARDS=true

# =============================================================================
# PERFORMANCE TUNING
# =============================================================================
# Database connection pooling
DB_POOL_SIZE=20
DB_MAX_OVERFLOW=30
DB_POOL_TIMEOUT=30
DB_POOL_RECYCLE=3600

# Query processing
MAX_SEARCH_RESULTS=100
DEFAULT_SEARCH_RESULTS=10
SEARCH_TIMEOUT_SECONDS=30
RERANK_TOP_K=50

# Background processing
WORKER_CONCURRENCY=4
WORKER_PREFETCH_MULTIPLIER=1
TASK_TIMEOUT_SECONDS=300

# =============================================================================
# SECURITY SETTINGS
# =============================================================================
# Authentication
ENABLE_AUTHENTICATION=true
SESSION_EXPIRE_DAYS=30
PASSWORD_MIN_LENGTH=8
REQUIRE_EMAIL_VERIFICATION=false

# Input validation
MAX_QUERY_LENGTH=1000
MAX_FILENAME_LENGTH=255
ALLOWED_MIME_TYPES=application/pdf,application/vnd.openxmlformats-officedocument.wordprocessingml.document,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,application/xml,text/plain,text/markdown,text/csv

# Security headers
ENABLE_CORS=true
ENABLE_CSRF_PROTECTION=true
SECURE_COOKIES=true
HTTPS_REDIRECT=false

# =============================================================================
# DEVELOPMENT SETTINGS
# =============================================================================
ENVIRONMENT=development
DEBUG=false
RELOAD=true
ACCESS_LOG=true

# Testing
TEST_DATABASE_URL=postgresql://raguser:change_this_secure_password_123@postgres:5432/ragdb_test
PYTEST_TIMEOUT=60

# =============================================================================
# BACKUP AND MAINTENANCE (NEW: Enterprise backup system)
# =============================================================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30
BACKUP_DIRECTORY=backups
BACKUP_COMPRESSION=true

# Backup Components (NEW: Selective backup)
BACKUP_DATABASES=true
BACKUP_DOCUMENTS=true
BACKUP_CONFIGURATION=true
BACKUP_VECTOR_INDICES=true

# Maintenance
AUTO_VACUUM_ENABLED=true
INDEX_OPTIMIZATION_SCHEDULE=0 3 * * 0  # Weekly on Sunday at 3 AM
CLEANUP_TEMP_FILES=true

# Backup Service Configuration (NEW)
BACKUP_SERVICE_TIMEOUT=3600  # 1 hour timeout for backups
BACKUP_VERIFY_INTEGRITY=true

# =============================================================================
# FEATURE FLAGS
# =============================================================================
ENABLE_QUERY_EXPANSION=true
ENABLE_RERANKING=true
ENABLE_CACHING=true
ENABLE_ANALYTICS=true
ENABLE_AUDIT_LOGGING=true
ENABLE_WEB_INTERFACE=true
ENABLE_WEBSOCKET=true

# Experimental features
ENABLE_HYBRID_SEARCH=false
ENABLE_SEMANTIC_CACHING=false
ENABLE_AUTO_SUMMARIZATION=false

# =============================================================================
# THIRD-PARTY INTEGRATIONS
# =============================================================================
# Optional: Email notifications
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASSWORD=
SMTP_USE_TLS=true
FROM_EMAIL=noreply@yourragdomain.com

# Optional: Object storage (S3-compatible)
USE_S3_STORAGE=false
S3_ENDPOINT=
S3_ACCESS_KEY=
S3_SECRET_KEY=
S3_BUCKET_NAME=rag-documents
S3_REGION=us-east-1

# Optional: Webhook notifications
WEBHOOK_URL=
WEBHOOK_SECRET=

# =============================================================================
# MULTI-TENANCY CONFIGURATION (NEW: Enterprise multi-tenant support)
# =============================================================================
ENABLE_MULTI_TENANCY=true
DEFAULT_TENANT=default
TENANT_ISOLATION_LEVEL=strict  # Options: strict, moderate, shared

# Tenant Resolution Strategy
TENANT_RESOLUTION_STRATEGY=subdomain  # Options: subdomain, domain, header, path
TENANT_HEADER_NAME=X-Tenant-ID
TENANT_PATH_PREFIX=/tenant

# Tenant-specific Features
TENANT_SPECIFIC_ENCRYPTION=true
TENANT_SPECIFIC_MODELS=false
TENANT_RESOURCE_QUOTAS=true

# Default Tenant Quotas
DEFAULT_DOCUMENT_LIMIT=1000
DEFAULT_QUERY_LIMIT_PER_HOUR=1000
DEFAULT_STORAGE_LIMIT_MB=1000

# =============================================================================
# SWISS DATA PROTECTION COMPLIANCE (NEW: GDPR/DSG compliance)
# =============================================================================
ENABLE_DATA_PROTECTION_MODE=true
DATA_RESIDENCY_REGION=CH  # Switzerland
ENABLE_RIGHT_TO_DELETION=true
ENABLE_DATA_EXPORT=true
ENABLE_CONSENT_MANAGEMENT=true

# Data Retention Policies
PERSONAL_DATA_RETENTION_DAYS=2555  # 7 years (Swiss requirement)
QUERY_LOG_RETENTION_DAYS=365
AUDIT_LOG_RETENTION_DAYS=2555

# Privacy Settings
ANONYMIZE_IP_ADDRESSES=true
HASH_USER_IDENTIFIERS=true
ENABLE_PRIVACY_BY_DESIGN=true

# =============================================================================
# GRAFANA CONFIGURATION
# =============================================================================
GRAFANA_PASSWORD=admin
GRAFANA_DATASOURCE_URL=http://prometheus:9090

# =============================================================================
# PROGRESS TRACKING SETTINGS
# =============================================================================

# Progress Tracking Configuration
ENABLE_PROGRESS_TRACKING=true
PROGRESS_PERSISTENCE_FILE=data/progress_operations.json
PROGRESS_CLEANUP_INTERVAL_HOURS=24
PROGRESS_MAX_AGE_HOURS=168  # 7 days

# WebSocket Configuration
WEBSOCKET_HEARTBEAT_INTERVAL=30
WEBSOCKET_TIMEOUT=300

# =============================================================================
# REDIS CACHE SETTINGS
# =============================================================================

# Redis Configuration
REDIS_URL=redis://localhost:6379
REDIS_DB=0
REDIS_MAX_CONNECTIONS=20
REDIS_TIMEOUT=5

# Cache Configuration
ENABLE_REDIS_CACHE=true
CACHE_DEFAULT_TTL=3600  # 1 hour
CACHE_ENABLE_COMPRESSION=true
CACHE_KEY_PREFIX=rag_cache

# Cache TTL Settings (in seconds)
CACHE_TTL_QUERY_RESULT=1800      # 30 minutes
CACHE_TTL_DOCUMENT_EMBEDDING=86400  # 24 hours
CACHE_TTL_SEARCH_RESULT=1800     # 30 minutes
CACHE_TTL_LLM_RESPONSE=3600      # 1 hour
CACHE_TTL_USER_SESSION=7200      # 2 hours
CACHE_TTL_SYSTEM_CONFIG=300      # 5 minutes
CACHE_TTL_TENANT_DATA=3600       # 1 hour
